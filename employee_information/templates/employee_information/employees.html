{% extends "employee_information/base.html" %}

{% block pageContent %}
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="card-title mb-0">Customer Conversion</h4>
            <div class="text-start">
                <div class="form-group">
                    <label for="start_date" class="d-none d-md-inline">Start Date:</label>
                    <input type="date" class="form-control form-control-sm" id="start_date" name="start_date">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card">
        <!-- Filter Section -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="include_inactive" name="include_inactive">
                <label class="form-check-label" for="include_inactive">Include Inactive Stores</label>
            </div>
          
            <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
            <button class="btn btn-success" onclick="downloadReport()">Download Report</button>
        </div>

        <!-- Table Section -->
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <colgroup>
                    <!-- Add colgroups as per your requirements -->
                </colgroup>
                <thead>
                    <tr>
                        <th class="text-center py-1">#</th>
                        <th class="text-center py-1">Name</th>
                        <th class="text-center py-1">Region</th>
                        <th class="text-center py-1">District</th>
                        <th class="text-center py-1">Store</th>
                        <th class="text-center py-1">Traffic</th>
                        <th class="text-center py-1">Conversion</th>
                        <th class="text-center py-1">Unmonitored Boxes</th> 
                        <th class="text-center py-1">Gross Profit ($)</th>
                        <th class="text-center py-1">Gross Profit / Traffic</th>
                        <th class="text-center py-1">Unmonitored Gross Profit</th>
                        <th class="text-center py-1">Total Gross Profit</th>
                        <th class="text-center py-1">Monitored Percentage</th>
                    </tr>
                </thead>
                <tbody id="employee_table_body">
                    <tr>
                        <td class="px-2 py-1 text-center">1</td>
                        <td class="px-2 py-1 text-start">Sam</td>
                        <td class="px-2 py-1 text-start">UK</td>
                        <td class="px-2 py-1 text-start">Nil</td>
                        <td class="px-2 py-1 text-start">73873</td>
                        <td class="px-2 py-1 text-start">23%</td>
                        <td class="px-2 py-1 text-start">787882</td>
                        <td class="px-2 py-1 text-start">6727</td>
                        <td class="px-2 py-1 text-start">1</td>
                        <td class="px-2 py-1 text-start">722</td>
                        <td class="px-2 py-1 text-start">1234</td>
                        <td class="px-2 py-1 text-start">1</td>
                        <td class="px-2 py-1 text-start">5%</td>
                    </tr>

                    <tr>
                        <td class="px-2 py-1 text-center">2</td>
                        <td class="px-2 py-1 text-start">John</td>
                        <td class="px-2 py-1 text-start">UK</td>
                        <td class="px-2 py-1 text-start">Nil</td>
                        <td class="px-2 py-1 text-start">653</td>
                        <td class="px-2 py-1 text-start">3%</td>
                        <td class="px-2 py-1 text-start">9982</td>
                        <td class="px-2 py-1 text-start">8827</td>
                        <td class="px-2 py-1 text-start">2</td>
                        <td class="px-2 py-1 text-start">72</td>
                        <td class="px-2 py-1 text-start">14</td>
                        <td class="px-2 py-1 text-start">7</td>
                        <td class="px-2 py-1 text-start">7%</td>
                    </tr>

                    <tr>
                        <td class="px-2 py-1 text-center">3</td>
                        <td class="px-2 py-1 text-start">76</td>
                        <td class="px-2 py-1 text-start">US</td>
                        <td class="px-2 py-1 text-start">Nil</td>
                        <td class="px-2 py-1 text-start">367</td>
                        <td class="px-2 py-1 text-start">7%</td>
                        <td class="px-2 py-1 text-start">967</td>
                        <td class="px-2 py-1 text-start">8687</td>
                        <td class="px-2 py-1 text-start">986</td>
                        <td class="px-2 py-1 text-start">9</td>
                        <td class="px-2 py-1 text-start">19687</td>
                        <td class="px-2 py-1 text-start">1</td>
                        <td class="px-2 py-1 text-start">8%</td>
                    </tr>
                    <tr>
                        <td class="px-2 py-1 text-center">4</td>
                        <td class="px-2 py-1 text-start">79</td>
                        <td class="px-2 py-1 text-start">Melbourne</td>
                        <td class="px-2 py-1 text-start">Nil</td>
                        <td class="px-2 py-1 text-start">257</td>
                        <td class="px-2 py-1 text-start">3%</td>
                        <td class="px-2 py-1 text-start">547</td>
                        <td class="px-2 py-1 text-start">2972</td>
                        <td class="px-2 py-1 text-start">872</td>
                        <td class="px-2 py-1 text-start">3</td>
                        <td class="px-2 py-1 text-start">72973</td>
                        <td class="px-2 py-1 text-start">8</td>
                        <td class="px-2 py-1 text-start">5%</td>
                    </tr>

                    <tr>
                        <td class="px-2 py-1 text-center">5</td>
                        <td class="px-2 py-1 text-start">27</td>
                        <td class="px-2 py-1 text-start">US</td>
                        <td class="px-2 py-1 text-start">Nil</td>
                        <td class="px-2 py-1 text-start">587</td>
                        <td class="px-2 py-1 text-start">9%</td>
                        <td class="px-2 py-1 text-start">457</td>
                        <td class="px-2 py-1 text-start">625</td>
                        <td class="px-2 py-1 text-start">62763</td>
                        <td class="px-2 py-1 text-start">10</td>
                        <td class="px-2 py-1 text-start">72877</td>
                        <td class="px-2 py-1 text-start">2</td>
                        <td class="px-2 py-1 text-start">6%</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(function() {
        $('#create_new').click(function() {
            uni_modal("Add New Employee", "{% url 'manage_employees-page' %}", 'modal-lg')
        })
        $('.view-data').click(function() {
            uni_modal("Employee Details", "{% url 'view-employee-page' %}?id=" + $(this).attr('data-id'), 'mid-large')
        })
        $('.edit-data').click(function() {
            uni_modal("Edit Employee", "{% url 'manage_employees-page' %}?id=" + $(this).attr('data-id'), 'modal-lg')
        })
        $('.delete-data').click(function() {
            _conf("Are you sure to delete this employee?", "delete_employee", [$(this).attr('data-id')])
        })

        function updateTable(data) {
            $('#employee_table_body').empty();
            for (const employee of data) {
                let row = `<tr>
                    <!-- Add your table columns as per your requirements -->
                </tr>`;
                $('#employee_table_body').append(row);
            }
        }

        function generateReport() {
            let data = [
                // Sample data
            ];

            updateTable(data);
        }

        function downloadReport() {
            let csvContent = "data:text/csv;charset=utf-8,";
            let rows = document.querySelectorAll("table tr");

            rows.forEach(function (row) {
                let rowData = [];
                let cols = row.querySelectorAll("td, th");

                cols.forEach(function (col) {
                    rowData.push(col.innerText);
                });

                csvContent += rowData.join(",") + "\n";
            });

            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "employee_report.csv");
            document.body.appendChild(link);
            link.click();
        }
    })

    function delete_employee($id) {
        // Your existing delete function
    }
</script>
{% endblock %}
